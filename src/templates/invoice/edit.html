{% extends "base.html" %}

{% block content %}
<h2>Rechnung</h2>
<h3>{{ invoice.vendor }} – {{ invoice.invoice_number }}</h3>

<form id="invoice-edit-form" method="post">
    {% for ii in invoice_items %}
    <div class="row pb-2 pt-2 border-top">
        <div class="col-9">
            <span>{{ ii.description }} – {{ ii.amount }}x {{ ii.net_price_single }}&euro; = {{ ii.net_price_total }}&euro; net / VAT: {{ ii.vat }}%</span>
        </div>
        <div class="col-3">
            <select class="form-select" name="{{ ii.id.unwrap() }}">
                <option {% if ii.cost_centre_id.is_none() %}selected{% endif %}  value="">Kostenstelle auswählen</option>
                {% for cc in cost_centres %}
                <option {% if ii.cost_centre_id.is_some() && ii.cost_centre_id.unwrap() == cc.id %}selected{% endif %} value="{{cc.id}}">{{cc.name}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-1"></div>
    </div>
    {% endfor %}

    <button type="submit" class="btn btn-primary">Speichern</button>
</form>
{% endblock content %}

{% block extra_js %}
<script>
    (function () {
        'use strict'
        const inputs = document.querySelectorAll('form#invoice-edit-form select');
        console.log(inputs)
        Array.from(inputs).forEach(input => {
            if (input.value === "") {
                input.classList.add("is-invalid")
            } else {
                input.classList.add("is-valid")
            }

            input.addEventListener('change', event => {
               if (input.value === "") {
                   input.classList.remove("is-valid")
                   input.classList.add("is-invalid")
               } else {
                   input.classList.remove("is-invalid")
                   input.classList.add("is-valid")
               }
            }, false)
        })
    })()
</script>
{% endblock extra_js %}
